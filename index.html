<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, target-densitydpi=medium-dpi" />

    <link rel="stylesheet" href="libs/jQM-flat/jquery.mobile.flatui.css">
    <link rel="stylesheet" type="text/css" href="css/index.css" />

    <title>Teste - Dev Web</title>

    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/geturi.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script type="text/javascript">
        var idSelecionado = 0;

        function pegaIdSelecionado(arg) {
            idSelecionado = arg;
            return false;
        }
    </script>

</head>

<body>

    <div id="app">

        <div id="home-page" data-role="page">
            <div data-role="content">
                <div id="menu">
                    <a data-icon="flat-man" data-theme="d" href="#contatos-page" data-role="button">Contatos</a>
                    <a data-icon="flat-plus" data-theme="f" href="#cadastro-page" data-role="button">Cadastre-se</a>
                    <a data-icon="flat-settings" data-theme="e" href="#login-page" data-role="button">Editar</a>
                    <a data-icon="flat-location" data-theme="g" href="#grafico-page" data-role="button">Google API</a>
                </div>
            </div>
        </div>

        <div id="grafico-page" data-role="page">
            <div data-role="header" data-id="header" id="header" data-position="fixed" class="ui-header">
                <a href="#home-page" data-role="button" data-icon="arrow-l" data-inline="true">Voltar</a>
                <h1>Contatos</h1>
            </div>
            <div data-role="main">
                <div id="piechart" style="width: 900px; height: 500px;"></div>
            </div>
        </div>

        <div id="contatos-page" data-role="page">
            <div data-role="header" data-id="header" id="header" data-position="fixed" class="ui-header">
                <a href="#home-page" data-role="button" data-icon="arrow-l" data-inline="true">Voltar</a>
                <h1>Contatos</h1>
            </div>
            <div data-role="main">
                <div id="listview"></div>
            </div>
        </div>

        <div id="login-page" data-role="page">
            <div data-role="header" data-id="header" id="header" data-position="fixed" class="ui-header">
                <a href="#home-page" data-role="button" data-icon="arrow-l" data-inline="true">Voltar</a>
                <h1>Login</h1>
            </div>


            <div data-role="content">
                <form>

                    <input type="text" name="input-username" id="input-username" data-mini="true" placeholder="Login" />
                    <div style="margin-bottom:7px;"></div>
                    <input type="password" name="input-senha" id="input-senha" data-mini="true" placeholder="Senha" />

                    <div style="margin-bottom:7px;"></div>


                    <input type="button" data-theme="f" data-mini="false" class="ui-btn-hidden" aria-disabled="false" id="login-btn" value="Entrar" />

                </form>

                <div style="background:#fff700; !important;" data-role="popup" id="popUpDadosLoginInvalidos">
                    <p>Usuário ou senha inválidos, verifique.</p>
                </div>

                <div style="background:#fff700; !important;" data-role="popup" id="popUpFaltaDadosLogin">
                    <p>Informe o usuário e senha, campos obrigatórios.</p>
                </div>

            </div>

        </div>


        <div id="cadastro-page" data-role="page">
            <div data-role="header" data-id="header" id="header" data-position="fixed" class="ui-header">
                <a href="#home-page" data-role="button" data-icon="arrow-l" data-inline="true">Voltar</a>
                <h1>Novo Cadastro</h1>
            </div>
            <div data-role="content">
                <form id="search-form" action="">

                    <input type="text" name="nome" id="nome" data-mini="true" placeholder="Nome" required/>
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="username" id="username" data-mini="true" placeholder="Login" style="text-transform: lowercase;" />
                    <div style="margin-bottom:7px;"></div>
                    <input type="password" name="senha" id="senha" data-mini="true" placeholder="Senha" />
                    <div style="margin-bottom:7px;"></div>
                    <select name="categoria" id="categoria" data-native-menu="true" data-mini="true" data-theme="b">
                        <option value="">Categoria</option>
                        <option value="7">Brigadista</option>
                        <option value="6">Enfermeiro(a)</option>
                        <option value="5">Médico</option>
                        <option value="1">Monitor</option>
                        <option value="2">Peregrino(a)</option>
                        <option value="3">Responsável de Grupo</option>
                        <option value="4">Responsável pela Acolhida</option>
                    </select>
                    <div style="margin-bottom:7px;"></div>

                    <select name="idioma" id="idioma" data-native-menu="true" data-mini="true" data-theme="b">
                        <option value="">Idioma</option>
                        <option value="ar">Árabe</option>
                        <option value="es">Espanhol</option>
                        <option value="fr">Francês</option>
                        <option value="in">Inglês</option>
                        <option value="it">Italiano</option>
                        <option value="pt">Português</option>
                    </select>
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="email" id="email" data-mini="true" placeholder="Email" />
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="telefone" id="telefone" data-mini="true" placeholder="Telefone" />
                    <div style="margin-bottom:7px;"></div>
                    <select name="pais" id="pais" data-native-menu="true" data-mini="true" data-theme="b" placeholder="Pais">
                        <option value="">País</option>
                        <option value="ar">Argentina</option>
                        <option value="br">Brazil • Brasil</option>
                        <option value="cl">Chile</option>
                        <option value="co">Colombia</option>
                    </select>
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="estado" id="estado" data-mini="true" placeholder="Estado" />
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="cidade" id="cidade" data-mini="true" placeholder="Cidade" />
                    <input type="button" data-theme="f" data-mini="false" class="ui-btn-hidden" aria-disabled="false" id="insert" value="Salvar" />
                </form>



                <div style="background:#fff700; !important;" data-role="popup" id="popUpCamposVazios" class="ui-content" data-theme="b">
                    <p>Informe todos os campos, preenchimento obrigatório.</p>
                </div>


                <div style="background:#fff700; !important;" data-role="popup" id="popUpValorMinimoCampoLogin" class="ui-content" data-theme="b">
                    <p>Login inválido, minímo de 6 caracteres.</p>
                </div>

                <div style="background:#fff700; !important;" data-role="popup" id="popUpValorMinimoCampoLogin" class="ui-content" data-theme="b">
                    <p>Senha inválida, minímo de 6 caracteres.</p>
                </div>

                <div style="background:#fff700; !important;" data-role="popup" id="popLoginUtilizado" class="ui-content" data-theme="b">
                    <p>Login já utilizado, escolha outro.</p>
                </div>''

                <div style="background:#fff700; !important;" data-role="popup" id="popUpValorMinimoCampoSenha" class="ui-content" data-theme="b">
                    <p>Senha inválida, minímo de 6 caracteres</p>
                </div>
            </div>

        </div>

        <div id="edit-page" data-role="page">
            <div data-role="header" data-id="header" id="header" data-position="fixed" class="ui-header">
                <a href="#home-page" data-role="button" data-icon="arrow-l" data-inline="true">Voltar</a>
                <h1>Editar Cadastro</h1>
            </div>
            <div data-role="content">
                <form id="search-form" action="">

                    <input type="text" name="nome-edit" id="nome-edit" data-mini="true" placeholder="Nome" />
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="username-edit" id="username-edit" data-mini="true" placeholder="Login" readonly="true" />
                    <div style="margin-bottom:7px;"></div>
                    <select name="categoria-edit" id="categoria-edit" data-native-menu="true" data-mini="true" data-theme="b">
                        <option value="">Categoria</option>
                        <option value="7">Brigadista</option>
                        <option value="6">Enfermeiro(a)</option>
                        <option value="5">Médico</option>
                        <option value="1">Monitor</option>
                        <option value="2">Peregrino(a)</option>
                        <option value="3">Responsável de Grupo</option>
                        <option value="4">Responsável pela Acolhida</option>
                    </select>
                    <div style="margin-bottom:7px;"></div>

                    <select name="idioma-edit" id="idioma-edit" data-native-menu="true" data-mini="true" data-theme="b">
                        <option value="">Idioma</option>
                        <option value="ar">Árabe</option>
                        <option value="es">Espanhol</option>
                        <option value="fr">Francês</option>
                        <option value="in">Inglês</option>
                        <option value="it">Italiano</option>
                        <option value="pt">Português</option>
                    </select>
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="email-edit" id="email-edit" data-mini="true" placeholder="Email" />
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="telefone-edit" id="telefone-edit" data-mini="true" placeholder="Telefone" />
                    <div style="margin-bottom:7px;"></div>
                    <select name="pais-edit" id="pais-edit" data-native-menu="true" data-mini="true" data-theme="b" placeholder="Pais">
                        <option value="">País</option>
                        <option value="ar">Argentina</option>
                        <option value="br">Brazil • Brasil</option>
                        <option value="cl">Chile</option>
                        <option value="co">Colombia</option>
                    </select>
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="estado-edit" id="estado-edit" data-mini="true" placeholder="Estado" />
                    <div style="margin-bottom:7px;"></div>
                    <input type="text" name="cidade-edit" id="cidade-edit" data-mini="true" placeholder="Cidade" />
                    <button type="submit" data-theme="f" data-mini="false" class="ui-btn-hidden" aria-disabled="false" id="update-btn">
                        Salvar</button>
                </form>
            </div>

        </div>





        <div id="about-page" data-role="page">
            <div data-role="header" data-id="header1" data-position="fixed" class="ui-header">
                <a href="#" data-rel="back" data-role="button" data-icon="arrow-l" data-inline="true">Voltar</a>
                <h1>Suporte</h1>
            </div>
            <div data-role="content" class="big-text">
                <h2>Fabiano Carvalho</h2>
                <p>Email: carvalho.fabiano@gmail.com</p>
                <p>Telefone: +5561991199497</p>

            </div>

            <div data-role="content" class="big-text">
                <h2>Otávio Garrido</h2>
                <p>Email: otavio.grrd@gmail.com</p>
                <p>Telefone: +5561982291992</p>

            </div>

            <div data-role="content" class="big-text">
                <h2>Luis Gustavo Souza</h2>
                <p>Email: os.luisgustavo@gmail.com</p>
                <p>Telefone: +5516982205070</p>

            </div>
        </div>

        <div id="detalhes-page" data-role="page">
            <div data-role="header" data-id="header" id="header" data-position="fixed" class="ui-header">
                <a href="#home-page" data-role="button" data-icon="arrow-l" data-inline="true">Voltar</a>
                <h1>Detalhes</h1>
            </div>
            <div data-role="content">
                <form id="search-form" action="">
                    <label for="address">Nome</label>
                    <input type="text" name="nome-detalhe" id="nome-detalhe" data-mini="true" readonly="true" />

                    <label for="address">Categoria</label>
                    <input type="text" name="categoria-detalhe" id="categoria-detalhe" data-mini="true" readonly="true" />

                    <label for="address">Idioma</label>
                    <input type="text" name="idioma-detalhe" id="idioma-detalhe" data-mini="true" readonly="true" />

                    <label for="address">Email</label>
                    <input type="text" name="email-detalhe" id="email-detalhe" data-mini="true" readonly="true" />

                    <label for="address">Telefone</label>
                    <input type="text" name="telefone-detalhe" id="telefone-detalhe" data-mini="true" readonly="true" />


                    <label for="address">Pais</label>
                    <input type="text" name="pais-detalhe" id="pais-detalhe" data-mini="true" readonly="true" />

                    <label for="address">Cidade</label>
                    <input type="text" name="cidade-detalhe" id="cidade-detalhe" data-mini="true" readonly="true" />

                </form>
            </div>
        </div>

    </div>





    <script type="text/javascript" src="libs/fastclick.min.js"></script>
    <script type="text/javascript" src="phonegap.js"></script>
    <script type="text/javascript" src="libs/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="libs/jQueryMobile/jquery.mobile-1.3.2.min.js"></script>


    <script type="text/javascript" src="js/index.js"></script>

    <script type="text/javascript">
        $(document).on("pageshow", "#contatos-page", function() {
            var url = "http://104.131.233.239/android/appweb/getContatosNeoList.php";
            $.getJSON(url, function(result, status) {
                $("#listview").empty();
                    if (status === 'success') {


                        $.each(result, function(i, field) {
                            var id = field.id;
                            var nome = field.nome;
                            var username = field.login;
                            var categoria = field.categoria;
                            var idioma = field.idioma;
                            var email = field.email;
                            var telefone = field.telefone;
                            var pais = field.pais;
                            var estado = field.estado;
                            var cidade = field.cidade;

                            $("#listview").append('<a onclick="pegaIdSelecionado(' + id + ');" href="#detalhes-page" data-icon="flat-man" idContato="' + id + '" theme="f"  data-role="button" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="rever ui-btn ui-shadow ui-btn-corner-all ui-btn-icon-left ui-btn-up-f"><span class="ui-btn-inner"><span class="ui-btn-text">' + nome + '</span><span class="ui-icon ui-icon-flat-man ui-icon-shadow">&nbsp;</span></span></a>');

                        });
                    }
                })
                
        });



        $(document).on("pageshow", "#detalhes-page", function() {

            $("#nome-detalhe").val("");
            if (localData !== null) {
                var id = localData.id;
                var nome = localData.nome;
                var username = localData.login;
                var categoria = localData.categoria;
                var idioma = localData.idioma;
                var email = localData.email;
                var telefone = localData.telefone;
                var pais = localData.pais;
                var estado = localData.estado;
                var cidade = localData.cidade;
                $("#listview").append('<a onclick="pegaIdSelecionado(' + id + ');" href="#detalhes-page" data-icon="flat-man" idContato="' + id + '" theme="f"  data-role="button" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" class="rever ui-btn ui-shadow ui-btn-corner-all ui-btn-icon-left ui-btn-up-f"><span class="ui-btn-inner"><span class="ui-btn-text">' + nome + '</span><span class="ui-icon ui-icon-flat-man ui-icon-shadow">&nbsp;</span></span></a>');

                $("#nome-detalhe").val(nome);
                $("#categoria-detalhe").val(categoria);
                $("#idioma-detalhe").val(idioma);
                $("#email-detalhe").val(email);
                $("#telefone-detalhe").val(telefone);
                $("#pais-detalhe").val(pais);

                if (estado == null || estado == "null" || estado == "") {
                    $("#cidade-detalhe").val(cidade);
                } else {
                    $("#cidade-detalhe").val(cidade + " - " + estado);
                }
            } else {
                var url = "http://104.131.233.239/android/appweb/getDetalheContatoNeoList.php?id=" + idSelecionado;
                $.getJSON(url, function(result, status) {
                    if (status === 'success') {
                        //console.log(result);

                        $.each(result, function(i, field) {
                            var id = field.id;
                            var nome = field.nome;
                            var desc_categoria = field.descricao_categoria;
                            var desc_idioma = field.descricao_idioma;
                            var email = field.email;
                            var telefone = field.telefone;
                            var desc_pais = field.nome_pais;
                            var cidade = field.cidade;
                            var estado = field.estado;


                            $("#nome-detalhe").val(nome);
                            $("#categoria-detalhe").val(desc_categoria);
                            $("#idioma-detalhe").val(desc_idioma);
                            $("#email-detalhe").val(email);
                            $("#telefone-detalhe").val(telefone);
                            $("#pais-detalhe").val(desc_pais);

                            if (estado == null || estado == "null" || estado == "") {
                                $("#cidade-detalhe").val(cidade);
                            } else {
                                $("#cidade-detalhe").val(cidade + " - " + estado);
                            }


                        });
                    }
                });
            }
        });


        $(document).on("pageinit", "#login-page", function() {

            $("#input-username").val("");
            $("#input-senha").val("");
        });

        $(document).on("pagebeforeshow", "#cadastro-page", function() {

            $("#nome").val("");
            $("#username").val("");
            $("#senha").val("");
            $("#categoria").val("");
            $("#idioma").val("");
            $("#email").val("");
            $("#telefone").val("");
            $("#pais").val("");
            $("#estado").val("");
            $("#cidade").val("");
        });


        $(document).on("pageshow", "#grafico-page", function() {
            var cabecalho = ["País", "Quantidade"];
            var dados = [cabecalho];

            var url = "http://104.131.233.239/android/appweb/getQuantidadePorPais.php";
            $.getJSON(url, function(result, status) {
                if (status === 'success') {
                    $.each(result, function(i, field) {
                        var nomePais = field.nome_pais;
                        var quantidade = field.quantidade++;
                        dados.push([nomePais, quantidade]);
                    });

                }

                google.charts.load("current", {
                    packages: ["corechart", "bar"]
                });
                google.charts.setOnLoadCallback(drawChart);

                function drawChart() {

                    var data = google.visualization.arrayToDataTable(dados);

                    var options = {
                        title: 'Usuários por País'
                    };

                    var chart = new google.visualization.PieChart(document.getElementById('piechart'));
                    chart.draw(data, options);
                }

            });


        });

        $("#login-btn").click(function() {

            var username = $("#input-username").val();
            var senha = $("#input-senha").val();

            if (username.length > 0 && senha.length > 0) {

                $.ajax({
                    url: "http://104.131.233.239/android/appweb/getLoginNeoList.php?username=" + username + "&senha=" + senha,
                    dataType: "json",
                    success: function(data) {
                        if (data[0].login == null) {

                            $('#popUpDadosLoginInvalidos').popup('open');

                        } else if (data[0].login != null) {

                            var url = "http://104.131.233.239/android/appweb/getDetalhesAlteracao.php?id=" + data[0].login;
                            $.getJSON(url, function(result) {
                                console.log(result);

                                $.each(result, function(i, field) {

                                    var id = field.id;
                                    var nome = field.nome;
                                    var username = field.login;
                                    var email = field.email;
                                    var telefone = field.telefone;
                                    var categoria = field.categoria;
                                    var idioma = field.idioma;
                                    var estado = field.estado;
                                    var cidade = field.cidade;

                                    $("#id-edit").val(id);
                                    $("#nome-edit").val(nome);
                                    $("#username-edit").val(username);
                                    $("#email-edit").val(email);
                                    $("#telefone-edit").val(telefone);
                                    $("#categoria-edit").val(categoria);
                                    $("#idioma-edit").val(idioma);
                                    $("#estado-edit").val(estado);
                                    $("#cidade-edit").val(cidade);
                                });
                            });

                            $.mobile.changePage("#edit-page");
                        }
                    }
                });

            } else {

                $('#popUpFaltaDadosLogin').popup('open');

            }

        });


        $("#insert").click(function() {

            var nome = $("#nome").val();
            var username = $("#username").val();
            var senha = $("#senha").val();
            var categoria = $("#categoria").val();
            var idioma = $("#idioma").val();
            var email = $("#email").val();
            var telefone = $("#telefone").val();
            var pais = $("#pais").val();
            var estado = $("#estado").val();
            var cidade = $("#cidade").val();

            var dataString = "nome=" + nome + "&username=" + username + "&senha=" + senha + "&idioma=" + idioma + "&email=" + email + "&telefone=" + telefone + "&pais=" + pais + "&cidade=" + cidade + "&estado=" + estado + "&insert=";
           
            if ($.trim(nome).length >= 0 & $.trim(username).length >= 0 & $.trim(senha).length >= 0 & categoria > 0 & $.trim(idioma).length > 0 & $.trim(pais).length > 0 & $.trim(email).length > 0 & $.trim(telefone).length > 0 & $.trim(estado).length > 0 & $.trim(cidade).length > 0) {

                if ($.trim(username).length >= 6) {

                    if ($.trim(senha).length >= 6) {

                        $.ajax({
                            url: "http://104.131.233.239/android/appweb/getExistenciaLogin.php?username=" + username + "",
                            dataType: "json",
                            success: function(data) {
                                if (data[0].login == null) {

                                    $.ajax({
                                        type: "POST",
                                        url: "http://104.131.233.239/android/appweb/insertUsuariosNeoList.php",
                                        data: dataString,
                                        crossDomain: true,
                                        cache: false,
                                        beforeSend: function() {
                                            $("#insert").val('Connecting...');
                                        },
                                        success: function(data) {
                                            $.mobile.changePage("#home-page");
                                        }
                                    });

                                } else {
                                    $('#popUpLoginUtilizado').popup('open');

                                }
                            }
                        });

                    } else {

                        $('#popUpValorMinimoCampoSenha').popup('open');
                    }

                } else {

                    $('#popUpValorMinimoCampoLogin').popup('open');
                }

            } else {

                $('#popUpCamposVazios').popup('open');
            }
            return false;
        });

        $("#update-btn").click(function() {

            var id = $("#id-edit").val();
            var nome = $("#nome-edit").val();
            var categoria = $("#categoria-edit").val();
            var idioma = $("#idioma-edit").val();
            var email = $("#email-edit").val();
            var telefone = $("#telefone-edit").val();
            var pais = $("#pais-edit").val();
            var estado = $("#estado-edit").val();
            var cidade = $("#cidade-edit").val();

            var dataString = "nome-edit=" + nome + "&categoria-edit=" + categoria + "&idioma-edit=" + idioma + "&email-edit=" + email + "&telefone-edit=" + telefone + "&pais-edit=" + pais + "&cidade-edit=" + cidade + "&estado-edit=" + estado + "id-edit=" + id + "&update=";

            if ($.trim(nome).length >= 0 & categoria > 0 & $.trim(idioma).length > 0 & $.trim(pais).length > 0 & $.trim(email).length > 0 & $.trim(telefone).length > 0 &
                $.trim(estado).length > 0 & $.trim(cidade).length > 0) {

                $.ajax({
                    type: "POST",
                    //url: "http://phonegappro.esy.es/test/insert.php",
                    url: "http://104.131.233.239/android/appweb/updateUsuariosNeoList.php",
                    data: dataString,
                    crossDomain: true,
                    cache: false,
                    beforeSend: function() {
                        $("#insert").val('Connecting...');
                    },
                    success: function(data) {
                        $.mobile.changePage("#home-page");
                    }
                });

            } else {

                $('#popUpCamposVaziosUpdate').popup('open');
            }
            return false;
        });
    </script>

</body>

</html>